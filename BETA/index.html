<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SÄ±nÄ±rsÄ±z Katlama SimÃ¼latÃ¶rÃ¼</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background-color: #2c3e50;
    margin: 0;
    font-family: sans-serif;
    overflow: hidden;
  }

  .info-text {
    color: #ecf0f1;
    font-size: 16px;
    margin-bottom: 20px;
    text-align: center;
    padding: 0 20px;
  }

  /* 3D Kamera ve Ã‡alÄ±ÅŸma AlanÄ± */
  .scene {
    perspective: 2000px;
  }

  /* Bu alan sadece olaylarÄ± dinler ve kaÄŸÄ±dÄ± tutar */
  #workspace {
    position: relative;
    width: 90vw;
    max-width: 600px;
    height: 60vw;
    max-height: 400px;
    cursor: crosshair;
    background-color: rgba(0,0,0,0.2); /* Sadece Ã§alÄ±ÅŸma alanÄ±nÄ±n sÄ±nÄ±rlarÄ±nÄ± belli eden ince bir zemin */
    touch-action: none;
    box-shadow: 0 15px 35px rgba(0,0,0,0.5);
  }

  /* Katlama Konteynerleri (Ä°Ã§ iÃ§e geÃ§erek Ã§oklu katlamayÄ± saÄŸlar) */
  .fold-wrapper, .fold-part {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    transform-style: preserve-3d;
  }

  /* Hareketli ParÃ§anÄ±n Animasyonu */
  .fold-part.rotating {
    transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    /* KatlandÄ±ÄŸÄ±nda katmanlar arasÄ± derinlik hissi versin diye hafif gÃ¶lge */
    filter: drop-shadow(-2px 5px 10px rgba(0,0,0,0.3)); 
  }

  /* TAMAMEN OPAK KAÄžIT TASARIMI */
  .paper-content {
    width: 100%;
    height: 100%;
    /* ÅžeffaflÄ±k kaldÄ±rÄ±ldÄ±. KatÄ±, sarÄ±mtÄ±rak bir kaÄŸÄ±t rengi. */
    background-color: #fdf5e6; 
    border: 2px solid #bdc3c7; /* Ã‡izgilerin belli olmasÄ± iÃ§in gri kenarlÄ±k */
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(30px, 6vw, 60px);
    font-weight: bold;
    color: #95a5a6; /* Tamamen opak yazÄ± rengi */
  }

  /* Ã‡izgi Ã‡ekerken Ã‡Ä±kan KÄ±lavuz */
  .draw-line {
    position: absolute;
    height: 3px;
    background-color: #e74c3c;
    transform-origin: 0 50%;
    pointer-events: none;
    z-index: 100;
    display: none;
    box-shadow: 0 0 8px #e74c3c;
  }

  /* SÄ±fÄ±rlama Butonu */
  button {
    margin-top: 30px;
    padding: 12px 30px;
    font-size: 16px;
    font-weight: bold;
    color: white;
    background-color: #3498db;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: background-color 0.3s;
  }

  button:hover { background-color: #2980b9; }
</style>
</head>
<body>

  <div class="info-text">
    ðŸ‘† <b>Ä°stediÄŸin Kadar Katla:</b> Ã‡izgi Ã§ek ve bÄ±rak!<br>
    <span style="font-size: 14px; opacity: 0.8;">Her yeni Ã§izgi, mevcut katlanmÄ±ÅŸ ÅŸekli tekrar katlar.</span>
  </div>

  <div class="scene">
    <div id="workspace">
      <div id="current-paper" class="fold-wrapper">
        <div class="paper-content">ORIGAMI</div>
      </div>
      <div class="draw-line" id="line"></div>
    </div>
  </div>

  <button onclick="resetPaper()">KaÄŸÄ±dÄ± SÄ±fÄ±rla (AÃ§)</button>

  <script>
    const workspace = document.getElementById('workspace');
    const line = document.getElementById('line');
    
    let isDrawing = false;
    let startX, startY;

    // Ortak Koordinat AlÄ±cÄ± (Fare ve Dokunmatik)
    function getPointerPos(e) {
      if (e.touches && e.touches.length > 0) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      if (e.changedTouches && e.changedTouches.length > 0) return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
      return { x: e.clientX, y: e.clientY };
    }

    // 1. Ã‡izime BaÅŸla
    function handleStart(e) {
      e.preventDefault();
      const pos = getPointerPos(e);
      const rect = workspace.getBoundingClientRect();
      startX = pos.x - rect.left;
      startY = pos.y - rect.top;
      isDrawing = true;
      
      line.style.display = 'block';
      line.style.width = '0px';
      line.style.left = startX + 'px';
      line.style.top = startY + 'px';
    }

    // 2. Ã‡izgiyi SÃ¼rÃ¼kle
    function handleMove(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const pos = getPointerPos(e);
      const rect = workspace.getBoundingClientRect();
      let currentX = pos.x - rect.left;
      let currentY = pos.y - rect.top;
      
      let dx = currentX - startX;
      let dy = currentY - startY;
      let length = Math.sqrt(dx*dx + dy*dy);
      let angle = Math.atan2(dy, dx) * 180 / Math.PI;
      
      line.style.width = length + 'px';
      line.style.transform = `rotate(${angle}deg)`;
    }

    // 3. Ã‡oklu Katlama MantÄ±ÄŸÄ± (Recursive DOM)
    function handleEnd(e) {
      if (!isDrawing) return;
      isDrawing = false;
      line.style.display = 'none'; // Ã‡izgiyi gizle
      
      const pos = getPointerPos(e);
      const rect = workspace.getBoundingClientRect();
      let endX = pos.x - rect.left;
      let endY = pos.y - rect.top;
      
      let dx = endX - startX;
      let dy = endY - startY;
      let length = Math.sqrt(dx*dx + dy*dy);
      
      if (length < 20) return; // YanlÄ±ÅŸlÄ±kla tÄ±klamalarÄ± engelle

      // VektÃ¶r HesaplamalarÄ±
      let ux = dx / length;
      let uy = dy / length;
      let nx = -uy;
      let ny = ux;
      let K = 5000; // EkranÄ± bÃ¶lecek kadar bÃ¼yÃ¼k bir Ã§arpan
      
      let p1x = startX - ux * K; let p1y = startY - uy * K;
      let p2x = startX + ux * K; let p2y = startY + uy * K;
      
      // Ã‡izginin A ve B taraflarÄ± iÃ§in poligon (maske) koordinatlarÄ±
      let c1x = p2x + nx * K; let c1y = p2y + ny * K;
      let c2x = p1x + nx * K; let c2y = p1y + ny * K;
      let clipA = `polygon(${p1x}px ${p1y}px, ${p2x}px ${p2y}px, ${c1x}px ${c1y}px, ${c2x}px ${c2y}px)`;
      
      let c3x = p2x - nx * K; let c3y = p2y - ny * K;
      let c4x = p1x - nx * K; let c4y = p1y - ny * K;
      let clipB = `polygon(${p1x}px ${p1y}px, ${p2x}px ${p2y}px, ${c3x}px ${c3y}px, ${c4x}px ${c4y}px)`;

      // --- Ä°Ã‡ Ä°Ã‡E GEÃ‡EN YENÄ° DOM YAPISI OLUÅžTURMA ---
      const currentPaper = document.getElementById('current-paper');
      
      // Yeni bir sarmalayÄ±cÄ± oluÅŸtur
      const newWrapper = document.createElement('div');
      newWrapper.className = 'fold-wrapper';
      newWrapper.id = 'current-paper'; // ArtÄ±k yeni "ana kaÄŸÄ±dÄ±mÄ±z" bu
      
      // Sabit kalacak parÃ§a (Ã‡izginin A tarafÄ±)
      const stationaryPart = document.createElement('div');
      stationaryPart.className = 'fold-part';
      stationaryPart.style.clipPath = clipA;
      // Mevcut kaÄŸÄ±dÄ±n tam bir kopyasÄ±nÄ± alÄ±p iÃ§ine koy
      stationaryPart.appendChild(currentPaper.cloneNode(true));
      
      // Katlanacak hareketli parÃ§a (Ã‡izginin B tarafÄ±)
      const rotatingPart = document.createElement('div');
      rotatingPart.className = 'fold-part rotating';
      rotatingPart.style.clipPath = clipB;
      rotatingPart.style.transformOrigin = `${startX}px ${startY}px`;
      // Orijinal kaÄŸÄ±dÄ± bunun iÃ§ine taÅŸÄ±
      rotatingPart.appendChild(currentPaper);
      
      // ParÃ§alarÄ± yeni sarmalayÄ±cÄ±ya ekle
      newWrapper.appendChild(stationaryPart);
      newWrapper.appendChild(rotatingPart);
      
      // Eski kaÄŸÄ±dÄ±n yerine yeni sarmalayÄ±cÄ±yÄ± Ã§alÄ±ÅŸma alanÄ±na ekle
      workspace.appendChild(newWrapper);

      // Animasyonu baÅŸlat (Hafif bir Z ekseni ekliyoruz ki kaÄŸÄ±tlar Ã¼st Ã¼ste binerken grafik hatasÄ±/z-fighting olmasÄ±n)
      setTimeout(() => {
        rotatingPart.style.transform = `rotate3d(${dx}, ${dy}, 0, 178deg) translateZ(1px)`;
      }, 50);
    }

    // SayfayÄ± BaÅŸlangÄ±Ã§ Haline DÃ¶ndÃ¼ren Fonksiyon
    function resetPaper() {
      const origHTML = `
        <div id="current-paper" class="fold-wrapper">
          <div class="paper-content">ORIGAMI</div>
        </div>
        <div class="draw-line" id="line"></div>
      `;
      workspace.innerHTML = origHTML;
      // line elementini yeniden baÄŸla
      document.getElementById('line').style.display = 'none';
    }

    // Olay Dinleyicileri (Hem dokunmatik hem fare)
    workspace.addEventListener('mousedown', handleStart);
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('mouseup', handleEnd);

    workspace.addEventListener('touchstart', handleStart, { passive: false });
    window.addEventListener('touchmove', handleMove, { passive: false });
    window.addEventListener('touchend', handleEnd);
  </script>

</body>
</html>
